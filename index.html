<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´„ç€¾æºªè°·ç§˜å¢ƒæ¢éšª | èŠ±è“®æº¯æºªé«”é©—</title>
    <!-- Tailwind CSS (æ¨£å¼åº«) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#0ea5e9',
              secondary: '#10b981',
              dark: '#0f172a',
            }
          }
        }
      }
    </script>
    <!-- Lucide Icons (åœ–ç¤ºåº«) -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        html { scroll-behavior: smooth; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .modal-open { overflow: hidden; }
        
        /* å‹•ç•«æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        .animate-slide-up { animation: slideUp 0.4s ease-out; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased font-sans">

    <!-- Navbar -->
    <header id="navbar" class="fixed w-full z-50 transition-all duration-300 py-5">
        <div class="container mx-auto px-4 md:px-6 flex justify-between items-center">
            <a href="#home" class="flex items-center gap-2 text-2xl font-bold nav-text text-white drop-shadow-md">
                <i data-lucide="mountain" class="w-8 h-8 text-secondary"></i>
                <span>æ´„ç€¾æºªè°·æ¢éšª</span>
            </a>
            <nav class="hidden md:flex gap-8">
                <a href="#home" class="nav-link text-lg font-medium hover:text-secondary transition-colors text-white drop-shadow-sm">é¦–é </a>
                <a href="#trips" class="nav-link text-lg font-medium hover:text-secondary transition-colors text-white drop-shadow-sm">æ¢éšªè·¯ç·š</a>
                <a href="#about" class="nav-link text-lg font-medium hover:text-secondary transition-colors text-white drop-shadow-sm">é—œæ–¼æˆ‘å€‘</a>
                <a href="#contact" class="nav-link text-lg font-medium hover:text-secondary transition-colors text-white drop-shadow-sm">è¯çµ¡æˆ‘å€‘</a>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="relative h-screen w-full flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0 z-0">
            <img src="https://images.unsplash.com/photo-1519834785169-98be25ec3f84?q=80&w=1920&auto=format&fit=crop" class="w-full h-full object-cover" />
            <div class="absolute inset-0 bg-black/40"></div>
        </div>
        <div class="relative z-10 text-center text-white px-4 animate-slide-up">
            <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold mb-6 tracking-tight drop-shadow-lg">æ´„ç€¾æºªè°·ç§˜å¢ƒæ¢éšª</h1>
            <p className="text-xl md:text-2xl font-light mb-10 max-w-2xl mx-auto drop-shadow-md">æ·±å…¥èŠ±è“®ç„¡äººä¹‹å¢ƒï¼Œé«”é©—æœ€ç´”ç²¹çš„å¤§è‡ªç„¶</p>
            <a href="#trips" class="inline-block bg-secondary hover:bg-emerald-600 text-white font-bold py-4 px-10 rounded-full transition-transform hover:scale-105 shadow-lg backdrop-blur-sm bg-opacity-90">é–‹å§‹æ¢éšª</a>
        </div>
    </section>

    <!-- Trips List -->
    <section id="trips" class="py-20 bg-white">
        <div class="container mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">æ¢éšªè·¯ç·š</h2>
                <div class="w-20 h-1 bg-secondary mx-auto rounded-full"></div>
            </div>
            <div id="trip-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
                <!-- Trip Cards will be injected here by JS -->
            </div>
        </div>
    </section>

    <!-- Booking Modal (Hidden by default) -->
    <div id="booking-modal" class="fixed inset-0 z-[70] hidden">
        <div class="absolute inset-0 bg-gray-900/70 backdrop-blur-sm" onclick="closeModal()"></div>
        
        <!-- Modal Content Container -->
        <div class="absolute inset-0 md:inset-4 bg-white md:rounded-2xl flex flex-col md:flex-row overflow-hidden animate-slide-up shadow-2xl max-w-7xl mx-auto h-full md:h-auto md:max-h-[95vh]">
            
            <!-- Left: Scrollable Form -->
            <div class="flex-1 overflow-y-auto relative bg-gray-50">
                <!-- Mobile Header -->
                <div class="md:hidden sticky top-0 bg-white z-20 px-4 py-3 border-b flex justify-between items-center">
                    <h2 class="font-bold text-gray-800" id="mobile-trip-title">è¡Œç¨‹é è¨‚</h2>
                    <button onclick="closeModal()"><i data-lucide="x" class="text-gray-500"></i></button>
                </div>

                <div class="p-4 md:p-8 pb-32 md:pb-10">
                    <h2 class="hidden md:block text-3xl font-bold text-gray-800 mb-2">é è¨‚è¡Œç¨‹</h2>
                    <p class="hidden md:block text-gray-500 mb-8">è«‹å¡«å¯«è©³ç´°è³‡æ–™ä»¥ç¢ºä¿æ‚¨çš„ä¿éšªæ¬Šç›Š</p>

                    <form id="booking-form" class="space-y-6">
                        <!-- Basic Info & Contact -->
                        <section class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                                <i data-lucide="calendar" class="text-blue-500"></i> åŸºæœ¬è³‡è¨Š
                            </h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">é è¨ˆå‡ºç™¼æ—¥æœŸ *</label>
                                    <input type="date" id="tripDate" required class="w-full px-4 py-3 rounded-xl border bg-gray-50 focus:ring-2 focus:ring-secondary outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è¯çµ¡äººå§“å *</label>
                                    <input type="text" id="contactName" required placeholder="ç‹å°æ˜" class="w-full px-4 py-3 rounded-xl border bg-gray-50 focus:ring-2 focus:ring-secondary outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è¯çµ¡é›»è©± *</label>
                                    <input type="tel" id="contactPhone" required placeholder="0912345678" class="w-full px-4 py-3 rounded-xl border bg-gray-50 focus:ring-2 focus:ring-secondary outline-none">
                                </div>
                                <div class="md:col-span-2">
                                    <label class="block text-sm font-medium text-gray-700 mb-1">è¯çµ¡åœ°å€ *</label>
                                    <input type="text" id="contactAddress" required placeholder="ä¿éšªå¯„é€èˆ‡è¯çµ¡ç”¨" class="w-full px-4 py-3 rounded-xl border bg-gray-50 focus:ring-2 focus:ring-secondary outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ç·Šæ€¥è¯çµ¡äºº *</label>
                                    <input type="text" id="emergencyName" required class="w-full px-4 py-3 rounded-xl border bg-gray-50 focus:ring-2 focus:ring-secondary outline-none">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">ç·Šæ€¥è¯çµ¡é›»è©± *</label>
                                    <input type="tel" id="emergencyPhone" required class="w-full px-4 py-3 rounded-xl border bg-gray-50 focus:ring-2 focus:ring-secondary outline-none">
                                </div>
                            </div>
                        </section>

                        <!-- Participants Container -->
                        <div id="participants-container" class="space-y-4">
                            <!-- JS will inject participant cards here -->
                        </div>

                        <button type="button" onclick="addParticipant()" class="w-full py-4 border-2 border-dashed border-gray-300 rounded-2xl text-gray-500 font-bold hover:border-secondary hover:text-secondary hover:bg-secondary/5 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="plus"></i> æ–°å¢ä¸€ä½åƒåŠ è€…
                        </button>

                        <div class="pt-4 pb-8">
                             <label class="flex items-start gap-3 cursor-pointer">
                                <input type="checkbox" id="agreeTerms" class="mt-1 w-5 h-5 text-secondary border-gray-300 rounded focus:ring-secondary">
                                <span class="text-sm text-gray-600">æˆ‘å·²ç¢ºèªæ‰€æœ‰è³‡æ–™å¡«å¯«æ­£ç¢ºï¼Œä¸¦åŒæ„æ´»å‹•ç›¸é—œæ¢æ¬¾èˆ‡éš±ç§æ¬Šæ”¿ç­–ã€‚</span>
                            </label>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Right: Sticky Summary -->
            <div class="hidden md:flex w-96 bg-white border-l border-gray-200 flex-col shrink-0 z-30 shadow-xl">
                 <div class="p-6 flex justify-between items-center border-b border-gray-100">
                     <h3 class="font-bold text-gray-800">è¨‚å–®æ‘˜è¦</h3>
                     <button onclick="closeModal()" class="p-2 hover:bg-gray-100 rounded-full"><i data-lucide="x"></i></button>
                 </div>
                 <div class="p-6 flex-1 overflow-y-auto">
                     <div class="aspect-video rounded-xl overflow-hidden mb-4">
                         <img id="summary-image" src="" class="w-full h-full object-cover" />
                     </div>
                     <h4 id="summary-title" class="text-xl font-bold text-gray-900 mb-2"></h4>
                     <div class="space-y-2 text-sm text-gray-600 mb-6 border-b pb-4">
                         <div class="flex justify-between"><span>æ—¥æœŸ</span><span id="summary-date" class="font-medium text-gray-900">å°šæœªé¸æ“‡</span></div>
                         <div class="flex justify-between"><span>é›£åº¦</span><span id="summary-difficulty" class="font-medium text-gray-900"></span></div>
                         <div class="flex justify-between"><span>æ™‚é•·</span><span id="summary-duration" class="font-medium text-gray-900"></span></div>
                     </div>
                     
                     <div class="space-y-2">
                         <div class="flex justify-between text-gray-600">
                             <span>å–®åƒ¹</span>
                             <span id="summary-price"></span>
                         </div>
                         <div class="flex justify-between text-gray-600">
                             <span>äººæ•¸</span>
                             <span id="summary-count">x 1 ä½</span>
                         </div>
                         <div class="flex justify-between text-2xl font-bold text-secondary pt-2 border-t mt-2">
                             <span>ç¸½é‡‘é¡</span>
                             <span id="summary-total"></span>
                         </div>
                     </div>
                 </div>
                 <div class="p-6 border-t border-gray-100 bg-gray-50">
                     <button onclick="submitBooking()" id="submit-btn-desktop" class="w-full py-4 bg-secondary hover:bg-emerald-600 text-white rounded-xl font-bold shadow-lg flex items-center justify-center gap-2 transition-all">
                        ç¢ºèªé è¨‚ <i data-lucide="chevron-right"></i>
                     </button>
                 </div>
            </div>

            <!-- Mobile Bottom Bar -->
            <div class="md:hidden bg-white border-t border-gray-200 p-4 shrink-0 flex items-center justify-between gap-4 z-40 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                <div>
                    <div id="mobile-count" class="text-xs text-gray-500">1 äººåƒåŠ </div>
                    <div id="mobile-total" class="text-xl font-bold text-secondary">NT$ 0</div>
                </div>
                <button onclick="submitBooking()" id="submit-btn-mobile" class="flex-1 py-3 bg-secondary text-white rounded-xl font-bold shadow-md">ç¢ºèªé è¨‚</button>
            </div>
        </div>
    </div>

    <!-- Javascript Logic -->
    <script>
        // ==========================================
        // 1. è¨­å®šå€åŸŸ (è«‹ä¿®æ”¹é€™è£¡çš„ ID)
        // ==========================================
        
        const GOOGLE_FORM_CONFIG = {
            // è«‹æ›æˆæ‚¨çš„ Google Form 'action' URL (é€šå¸¸çµå°¾æ˜¯ formResponse)
            url: 'https://docs.google.com/forms/d/e/1FAIpQLSdO_TYqVbBvPMZ9xJGC3cKLxqKrj6X9YrRVQoQx0Xy5nrqC3Q/formResponse', 
            
            // è«‹æ›æˆæ‚¨ç”¨ã€Œé è¦½ -> æª¢æŸ¥å…ƒç´ ã€æ‰¾åˆ°çš„ entry ID
            fields: {
                name: 'entry.1623988474',          // åƒåŠ è€…å§“å
                birthDate: 'entry.1952703181',     // ç”Ÿæ—¥
                idNumber: 'entry.1812465871',      // èº«åˆ†è­‰
                phone: 'entry.1933097253',         // è¯çµ¡é›»è©±
                emergencyName: 'entry.94106424',   // ç·Šæ€¥è¯çµ¡äºº
                emergencyPhone: 'entry.1640555720',// ç·Šæ€¥é›»è©±
                address: 'entry.1248469550',       // åœ°å€
                shoeSize: 'entry.516143478',       // é‹è™Ÿ
                height: 'entry.152310246',         // èº«é«˜
                weight: 'entry.972135023',         // é«”é‡
                medicalConditions: 'entry.1995882209' // å¥åº·ç‹€æ³
                // æ³¨æ„ï¼štripName (è¡Œç¨‹åç¨±+æ—¥æœŸ) å’Œ tripPrice (åƒ¹æ ¼) 
                // å¦‚æœæ‚¨è¡¨å–®æœ‰é€™å…©å€‹æ¬„ä½ï¼Œè«‹åœ¨é€™è£¡åŠ é€™å…©å€‹ ID
                // å¦‚æœæ²’æœ‰ï¼ŒGoogle Sheet é‚„æ˜¯æœƒæ”¶åˆ°ï¼Œä½†æ‚¨éœ€è¦è‡ªå·±åœ¨ Sheet è£¡é¢æ•´ç†
            }
        };

        const TRIPS = [
            {
                id: 'xilin',
                title: 'è¥¿æ—ç§˜å¢ƒ',
                price: 3500,
                badge: 'åˆç´šè·¯ç·š ğŸ‘',
                imageUrl: 'https://images.unsplash.com/photo-1533873984035-25970ab07461?w=800&auto=format&fit=crop',
                description: '30å…¬å°ºé«˜ç€‘å¸ƒå‚é™ï¼Œç½•è¦‹Så‹ç€‘å¸ƒå¥‡æ™¯ï¼Œæ˜¯èŠ±è“®æœ€é©åˆåˆå­¸è€…é«”é©—çš„æºªè°·è·¯ç·šã€‚',
                duration: 'ç´„ 4-5 å°æ™‚',
                difficulty: 'åˆç´š'
            },
            {
                id: 'feicui',
                title: 'ç¿¡ç¿ è°·',
                price: 4200,
                badge: 'é€²éšè·¯ç·š ğŸ˜',
                imageUrl: 'https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=800&auto=format&fit=crop',
                description: 'éš±è—åœ¨ä¸­å¤®å±±è„ˆæ·±è™•çš„ç¿¡ç¿ è°·ï¼Œæ“æœ‰æ¸…æ¾ˆè¦‹åº•çš„ç¢§ç¶ æ·±æ½­ï¼Œå¤šå€‹å¤©ç„¶æ»‘æ°´é“å’Œè·³æ°´é»ã€‚',
                duration: 'ç´„ 5-6 å°æ™‚',
                difficulty: 'é€²éš'
            },
            {
                id: 'huangjin',
                title: 'é»ƒé‡‘å³½è°·',
                price: 3000,
                badge: 'è¦ªå­å‹å–„ ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
                imageUrl: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800&auto=format&fit=crop',
                description: 'æœ€é©åˆè¦ªå­åŒéŠçš„æºªè°·è·¯ç·šï¼Œæ“æœ‰é‡‘é»ƒè‰²çš„å³½è°·å²©å£å’Œæ¸…æ¶¼çš„æºªæ°´ã€‚',
                duration: 'ç´„ 3-4 å°æ™‚',
                difficulty: 'å…¥é–€'
            },
            {
                id: 'blue',
                title: 'è—è‰²ç§˜å¢ƒ',
                price: 3800,
                badge: 'ç¶²ç¾æ™¯é» ğŸ“¸',
                imageUrl: 'https://images.unsplash.com/photo-1551632811-561732d1e306?w=800&auto=format&fit=crop',
                description: 'å®›å¦‚è—å¯¶çŸ³èˆ¬çš„æ·±è—è‰²æ°´æ½­ï¼Œæ­é…å£¯è§€çš„ç€‘å¸ƒæ™¯è§€ï¼Œæ˜¯IGæ‰“å¡è–åœ°ã€‚',
                duration: 'ç´„ 4-5 å°æ™‚',
                difficulty: 'åˆä¸­ç´š'
            }
        ];

        // ==========================================
        // 2. æ‡‰ç”¨ç¨‹å¼ç‹€æ…‹ (State)
        // ==========================================
        let currentTrip = null;
        let participantCount = 1;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            renderTrips();
            lucide.createIcons();
            
            // è¨­å®šæ—¥æœŸæœ€å°ç‚ºä»Šå¤©
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('tripDate').min = today;
            
            // ç›£è½æ—¥æœŸè®Šæ›´ä»¥æ›´æ–°æ‘˜è¦
            document.getElementById('tripDate').addEventListener('change', (e) => {
                document.getElementById('summary-date').textContent = e.target.value || 'å°šæœªé¸æ“‡';
            });

            // Navbar Scroll Effect
            window.addEventListener('scroll', () => {
                const nav = document.getElementById('navbar');
                const navTexts = document.querySelectorAll('.nav-text, .nav-link');
                const icon = document.querySelector('[data-lucide="mountain"]');
                
                if (window.scrollY > 20) {
                    nav.classList.add('bg-white/90', 'backdrop-blur-md', 'shadow-md', 'py-3');
                    nav.classList.remove('py-5');
                    navTexts.forEach(el => {
                        el.classList.remove('text-white', 'drop-shadow-md', 'drop-shadow-sm');
                        el.classList.add('text-gray-900');
                    });
                } else {
                    nav.classList.remove('bg-white/90', 'backdrop-blur-md', 'shadow-md', 'py-3');
                    nav.classList.add('py-5');
                    navTexts.forEach(el => {
                        el.classList.add('text-white', 'drop-shadow-md', 'drop-shadow-sm');
                        el.classList.remove('text-gray-900');
                    });
                }
            });
        });

        // ==========================================
        // 3. UI æ¸²æŸ“é‚è¼¯
        // ==========================================

        function renderTrips() {
            const container = document.getElementById('trip-container');
            container.innerHTML = TRIPS.map(trip => `
                <div class="bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col h-full border border-gray-100 group">
                    <div class="relative h-64 overflow-hidden">
                        <img src="${trip.imageUrl}" alt="${trip.title}" class="w-full h-full object-cover transform group-hover:scale-110 transition-transform duration-700"/>
                        <div class="absolute top-4 right-4 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-full text-sm font-bold text-gray-800 shadow-sm">
                            ${trip.badge}
                        </div>
                    </div>
                    <div class="p-6 flex-1 flex flex-col">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-2xl font-bold text-gray-800">${trip.title}</h3>
                            <span class="text-xl font-bold text-secondary">NT$ ${trip.price.toLocaleString()}</span>
                        </div>
                        <div class="flex items-center gap-4 text-sm text-gray-500 mb-4">
                            <span class="flex items-center gap-1"><i data-lucide="clock" class="w-4 h-4"></i> ${trip.duration}</span>
                            <span class="flex items-center gap-1"><i data-lucide="trending-up" class="w-4 h-4"></i> ${trip.difficulty}</span>
                        </div>
                        <p class="text-gray-600 mb-6 flex-1">${trip.description}</p>
                        <button onclick="openModal('${trip.id}')" class="w-full py-3 bg-secondary text-white font-semibold rounded-lg hover:bg-emerald-600 transition-colors shadow-md">
                            ç«‹å³é è¨‚
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function openModal(tripId) {
            currentTrip = TRIPS.find(t => t.id === tripId);
            if (!currentTrip) return;

            // Reset Form
            document.getElementById('booking-form').reset();
            document.getElementById('participants-container').innerHTML = '';
            participantCount = 0;
            addParticipant(); // Add the first one

            // Update Summary UI
            document.getElementById('summary-image').src = currentTrip.imageUrl;
            document.getElementById('summary-title').textContent = currentTrip.title;
            document.getElementById('mobile-trip-title').textContent = currentTrip.title + ' é è¨‚';
            document.getElementById('summary-difficulty').textContent = currentTrip.difficulty;
            document.getElementById('summary-duration').textContent = currentTrip.duration;
            document.getElementById('summary-price').textContent = `NT$ ${currentTrip.price.toLocaleString()}`;
            document.getElementById('summary-date').textContent = 'å°šæœªé¸æ“‡';

            updateTotal();

            // Show Modal
            const modal = document.getElementById('booking-modal');
            modal.classList.remove('hidden');
            document.body.classList.add('modal-open');
        }

        function closeModal() {
            document.getElementById('booking-modal').classList.add('hidden');
            document.body.classList.remove('modal-open');
            currentTrip = null;
        }

        // ==========================================
        // 4. åƒåŠ è€…é‚è¼¯
        // ==========================================

        function addParticipant() {
            participantCount++;
            const id = Date.now(); // Unique ID for DOM element
            const html = `
                <div id="participant-${id}" class="participant-card bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all hover:shadow-md animate-fade-in">
                    <div class="bg-gray-50/50 px-6 py-3 border-b border-gray-100 flex justify-between items-center">
                        <span class="font-bold text-gray-700 participant-index">åƒåŠ è€…</span>
                        <button type="button" onclick="removeParticipant(${id})" class="delete-btn text-gray-400 hover:text-red-500 transition-colors ${participantCount === 1 ? 'hidden' : ''}">
                            <i data-lucide="trash-2" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="p-6 grid grid-cols-2 md:grid-cols-6 gap-4">
                        <div class="col-span-2 md:col-span-2">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">çœŸå¯¦å§“å *</label>
                            <input type="text" name="p_name" required class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none">
                        </div>
                        <div class="col-span-2 md:col-span-2">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">å‡ºç”Ÿå¹´æœˆæ—¥ *</label>
                            <input type="date" name="p_birth" required class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none">
                        </div>
                        <div class="col-span-2 md:col-span-2">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">èº«åˆ†è­‰/è­·ç…§ *</label>
                            <input type="text" name="p_id" required class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none">
                        </div>
                        <div class="col-span-1 md:col-span-2">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">èº«é«˜ (cm) *</label>
                            <input type="number" name="p_height" required class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none">
                        </div>
                        <div class="col-span-1 md:col-span-2">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">é«”é‡ (kg) *</label>
                            <input type="number" name="p_weight" required class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none">
                        </div>
                        <div class="col-span-2 md:col-span-2">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">é‹è™Ÿ (cm) *</label>
                            <select name="p_shoe" required class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none bg-white">
                                <option value="">é¸æ“‡</option>
                                ${[22, 23, 24, 25, 26, 27, 28, 29, 30].map(s => `<option value="${s}">${s}</option>`).join('')}
                            </select>
                        </div>
                        <div class="col-span-2 md:col-span-6">
                            <label class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">å¥åº·å‚™è¨»</label>
                            <input type="text" name="p_medical" placeholder="ç„¡ï¼Œæˆ–å¡«å¯«éæ•ã€ç—…å²" class="w-full px-3 py-2 rounded-lg border focus:border-secondary outline-none text-sm">
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('participants-container').insertAdjacentHTML('beforeend', html);
            lucide.createIcons();
            updateParticipantIndexes();
            updateTotal();
        }

        function removeParticipant(id) {
            const el = document.getElementById(`participant-${id}`);
            if (el) el.remove();
            updateParticipantIndexes();
            updateTotal();
        }

        function updateParticipantIndexes() {
            const cards = document.querySelectorAll('.participant-card');
            participantCount = cards.length;
            cards.forEach((card, index) => {
                card.querySelector('.participant-index').textContent = `åƒåŠ è€… #${index + 1}`;
                const deleteBtn = card.querySelector('.delete-btn');
                if (cards.length > 1) {
                    deleteBtn.classList.remove('hidden');
                } else {
                    deleteBtn.classList.add('hidden');
                }
            });
        }

        function updateTotal() {
            if (!currentTrip) return;
            const total = currentTrip.price * participantCount;
            const formattedTotal = `NT$ ${total.toLocaleString()}`;
            
            document.getElementById('summary-count').textContent = `x ${participantCount} ä½`;
            document.getElementById('summary-total').textContent = formattedTotal;
            
            document.getElementById('mobile-count').textContent = `${participantCount} äººåƒåŠ `;
            document.getElementById('mobile-total').textContent = formattedTotal;
        }

        // ==========================================
        // 5. é€å‡ºè¡¨å–® (æœ€é‡è¦éƒ¨åˆ†)
        // ==========================================

        async function submitBooking() {
            // 1. é©—è­‰
            const form = document.getElementById('booking-form');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const tripDate = document.getElementById('tripDate').value;
            const contactName = document.getElementById('contactName').value;
            const contactPhone = document.getElementById('contactPhone').value;
            const contactAddress = document.getElementById('contactAddress').value;
            const emergencyName = document.getElementById('emergencyName').value;
            const emergencyPhone = document.getElementById('emergencyPhone').value;
            const agreeTerms = document.getElementById('agreeTerms').checked;

            if (!agreeTerms) {
                alert('è«‹å‹¾é¸åŒæ„æ¢æ¬¾');
                return;
            }

            // UI Loading ç‹€æ…‹
            const btns = [document.getElementById('submit-btn-desktop'), document.getElementById('submit-btn-mobile')];
            btns.forEach(btn => {
                btn.disabled = true;
                btn.textContent = 'è™•ç†ä¸­...';
            });

            // 2. æ”¶é›†æ‰€æœ‰åƒåŠ è€…è³‡æ–™
            const participantCards = document.querySelectorAll('.participant-card');
            const total = participantCards.length;
            
            // è¡Œç¨‹å®Œæ•´åç¨± (å«æ—¥æœŸï¼Œå› ç‚º Google Form æ¬„ä½æœ‰é™ï¼Œæˆ‘å€‘æŠŠæ—¥æœŸä½µå…¥æ¨™é¡Œ)
            const fullTripName = `${currentTrip.title} (é ç´„: ${tripDate})`;

            // 3. æ‰¹æ¬¡é€å‡ºè¿´åœˆ
            try {
                for (let i = 0; i < total; i++) {
                    const card = participantCards[i];
                    const formData = new FormData();
                    
                    // å¡«å…¥ Google Form å°æ‡‰æ¬„ä½
                    // ç‚ºäº†ç¯€çœ Google Form æ¬„ä½ï¼Œæˆ‘å€‘å°‡åƒåŠ è€…è³‡æ–™ + è¯çµ¡äººè³‡æ–™åˆä½µé€å‡º
                    // é€™æ¨£ Google Sheet æ¯ä¸€è¡Œå°±æ˜¯ä¸€å€‹åƒåŠ è€…ï¼Œä¸”éƒ½æœ‰è¯çµ¡äººè³‡è¨Š
                    
                    const p_name = card.querySelector('[name="p_name"]').value;
                    
                    // æ›´æ–°æŒ‰éˆ•é€²åº¦
                    btns.forEach(btn => btn.textContent = `å‚³é€ä¸­ (${i + 1}/${total})`);

                    const mapping = {
                        [GOOGLE_FORM_CONFIG.fields.name]: p_name,
                        [GOOGLE_FORM_CONFIG.fields.birthDate]: card.querySelector('[name="p_birth"]').value,
                        [GOOGLE_FORM_CONFIG.fields.idNumber]: card.querySelector('[name="p_id"]').value,
                        [GOOGLE_FORM_CONFIG.fields.height]: card.querySelector('[name="p_height"]').value,
                        [GOOGLE_FORM_CONFIG.fields.weight]: card.querySelector('[name="p_weight"]').value,
                        [GOOGLE_FORM_CONFIG.fields.shoeSize]: card.querySelector('[name="p_shoe"]').value,
                        [GOOGLE_FORM_CONFIG.fields.medicalConditions]: card.querySelector('[name="p_medical"]').value || 'ç„¡',
                        
                        // å…±ç”¨è¯çµ¡äººè³‡è¨Š
                        [GOOGLE_FORM_CONFIG.fields.phone]: contactPhone,
                        [GOOGLE_FORM_CONFIG.fields.address]: contactAddress,
                        [GOOGLE_FORM_CONFIG.fields.emergencyName]: emergencyName,
                        [GOOGLE_FORM_CONFIG.fields.emergencyPhone]: emergencyPhone
                    };

                    // è½‰æ›æˆ FormData
                    for (const [entryId, value] of Object.entries(mapping)) {
                        if (entryId && value) formData.append(entryId, value);
                    }
                    
                    // ç‰¹æ®Šè™•ç†ï¼šå¦‚æœæ‚¨æƒ³æŠŠè¡Œç¨‹åç¨±ä¹Ÿå¡é€²æŸå€‹æ¬„ä½ï¼Œå¯ä»¥åœ¨ mapping è£¡åŠ 
                    // ä¾‹å¦‚ formData.append('entry.xxxxx', fullTripName);

                    // ç™¼é€è«‹æ±‚
                    // mode: 'no-cors' æ˜¯å¿…é ˆçš„ï¼Œå› ç‚º Google Form ä¸æ”¯æ´è·¨åŸŸå›æ‡‰
                    // é€™æ„å‘³è‘—æˆ‘å€‘æ”¶ä¸åˆ°ã€ŒæˆåŠŸã€çš„å›æ‡‰ï¼Œåªèƒ½å‡è¨­å®ƒæˆåŠŸ
                    await fetch(GOOGLE_FORM_CONFIG.url, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    });

                    // ç¨å¾®å»¶é²é¿å…è¢« Google é˜»æ“‹
                    await new Promise(r => setTimeout(r, 800));
                }

                alert(`âœ… é è¨‚æˆåŠŸï¼\n\nå…± ${total} ä½åƒåŠ è€…è³‡æ–™å·²é€å‡ºã€‚\næˆ‘å€‘å°‡ç›¡å¿«èˆ‡æ‚¨è¯ç¹« (${contactPhone})ã€‚`);
                closeModal();

            } catch (error) {
                console.error(error);
                alert('âš ï¸ å‚³é€æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚');
            } finally {
                btns.forEach(btn => {
                    btn.disabled = false;
                    btn.textContent = 'ç¢ºèªé è¨‚';
                });
            }
        }
    </script>
</body>
</html>
